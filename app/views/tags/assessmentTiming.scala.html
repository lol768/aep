@import domain.StudentAssessmentWithAssessment
@import play.api.libs.json.Json

@import play.api.libs.json.JsNumber
@import play.api.libs.json.JsBoolean
@import play.api.libs.json.JsNull
@import domain.Assessment.Platform
@(studentAssessmentWithAssessment: StudentAssessmentWithAssessment, isAssessmentPage: Boolean = false)(implicit request: RequestHeader, context: RequestContext)

@studentAssessmentWithAssessment.assessment.startTime.map { startTime =>
    <span>
        <i class="fad fa-fw fa-hourglass fa-hourglass-spin"></i>
        <span
        class="timing-information"
        data-id="@studentAssessmentWithAssessment.assessment.id"
        data-rendering="@{
            Json.stringify(Json.toJson(Map(
                "windowStart" -> JsNumber(startTime.toInstant.toEpochMilli),
                "windowEnd" -> JsNumber(studentAssessmentWithAssessment.assessment.lastAllowedStartTime.get.toInstant.toEpochMilli),
                "start" -> studentAssessmentWithAssessment.studentAssessment.startTime.map(st => JsNumber(st.toInstant.toEpochMilli)).getOrElse(JsNull),
                "end" -> studentAssessmentWithAssessment.studentAssessment.startTime.map(st => JsNumber(st.toInstant.toEpochMilli + studentAssessmentWithAssessment.duration.toMillis)).getOrElse(JsNull),
                "hasStarted" -> JsBoolean(studentAssessmentWithAssessment.studentAssessment.startTime.nonEmpty),
                "hasFinalised" -> JsBoolean(studentAssessmentWithAssessment.studentAssessment.finaliseTime.nonEmpty),
                "extraTimeAdjustment" -> studentAssessmentWithAssessment.studentAssessment.extraTimeAdjustment.map(et => JsNumber(et.toMillis)).getOrElse(JsNull),
                "showTimeRemaining" -> JsBoolean(studentAssessmentWithAssessment.assessment.platform == Platform.OnlineExams),
            )))
        }"
        ></span>
    </span>
}
