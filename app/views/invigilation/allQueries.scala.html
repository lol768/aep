@import domain.Assessment
@import domain.tabula
@import domain.AnnouncementOrQuery
@import warwick.sso.UniversityID
@import warwick.sso.User
@import warwick.sso.Usercode
@import views.html.invigilation._
@import tags._
@import controllers.invigilation.AnnouncementAndQueriesController.AnnouncementData
@(
        assessment: Assessment,
        announcementsAndQueries: Seq[AnnouncementOrQuery],
        students: Map[UniversityID, tabula.SitsProfile],
        department: Option[tabula.Department],
        form: Form[AnnouncementData],
        invigilators: Map[Usercode, User] = Map.empty[Usercode, User],
)(implicit request: RequestHeader, messagesProvider: MessagesProvider, context: RequestContext)
@adminLayout("Announcements and queries for " + assessment.moduleCode, extraClasses = Seq("connect-ws", "allAnnouncementsAndQueries")) {
  <div class="id7-main-content">
    <span class="in-progress-assessment-data" data-assessment="@assessment.id" data-usercode="@context.user.map(_.usercode.string)"></span>
    <div class="row">
      <div class="col-md-6">
        <h3>Announcements</h3>
        @b3.vertical.formCSRF(controllers.invigilation.routes.AnnouncementAndQueriesController.addAnnouncement(assessment.id), Symbol("class") -> "double-submit-protection") { implicit fc =>
          @views.html.tags.globalErrors(form)

          @b3.textarea(form("message"), Symbol("rows") -> 10)

          @b3.submit(Symbol("class") -> "btn btn-default"){ <i class="fas fa-plus fa-fw"></i> Add }
        }
        @displayAnnouncementsAndQueries(announcementsAndQueries.filter(_.isAnnouncement), students, "announcement", invigilators)
      </div>
      <div class="col-md-6">
        <h3>Queries</h3>
        @displayAnnouncementsAndQueries(announcementsAndQueries.filter(_.isQuery), students, "query", invigilators)
      </div>
    </div>

    <a class="btn btn-default" href="@controllers.invigilation.routes.InvigilatorAssessmentController.view(assessment.id)">
      <i class="fas fa-arrow-left"></i>
      Return to invigilation screen
    </a>
  </div>
}
