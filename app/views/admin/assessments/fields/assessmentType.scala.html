@import controllers.admin.AdminAssessmentsController.AssessmentFormData
@import domain.Assessment
@import domain.Assessment.{AssessmentType, Platform}
@import views.html.b3.vertical.VerticalFieldConstructor
@(existing: Option[Assessment], allowAssessmentTypeChangesOnImportedAssessments: Boolean)(implicit context: RequestContext, request: RequestHeader, messages: MessagesProvider, vfc: VerticalFieldConstructor, form: Form[AssessmentFormData])

<div class="row">
  <div class="col-sm-6">
    @if(!allowAssessmentTypeChangesOnImportedAssessments && existing.exists(_.tabulaAssessmentId.nonEmpty)) {
      @b3.hidden(form("assessmentType"))
    }
    @b3.radio(form("assessmentType"), Symbol("_label") -> (if (!allowAssessmentTypeChangesOnImportedAssessments && existing.exists(_.tabulaAssessmentId.nonEmpty)) "Type (as agreed by FAARG)" else "Type")) { implicit extraInfo =>
      @AssessmentType.values.map { t => @b3.radioOption(
        t.entryName,
        t.label,
        Seq(
          Some(Symbol("data-valid-durations") -> t.validDurations.mkString("[", ",", "]")),
          /* Intentionally disabled, not readonly here - radio buttons don't support readonly. Bug in b3.radioOption prevents us doing 'disabled -> booleanfunc */
          Some(Symbol("disabled") -> true).filter(_ => !allowAssessmentTypeChangesOnImportedAssessments && existing.exists(_.tabulaAssessmentId.nonEmpty))
        ).flatten: _*
      )}
    }
  </div>
  <div class="col-sm-6">
    @defining(form.errors("platform")) { errors =>
      @if(errors.nonEmpty) {
        <div class="has-error">
      }
      @b3.multiCheckbox(
        Platform.values.map { p =>
          form("platform[]") -> Seq(
            Symbol("id") -> s"platform_${p.entryName}",
            Symbol("_text") -> p.label,
            Symbol("value") -> p.entryName,
            Symbol("checked") -> form.data.filter(_._1.contains("platform")).values.toSeq.contains(p.entryName)
          )
        }: _*
      )(
        Symbol("_id") -> "platform_field",
        Symbol("_label") -> "Platform",
        Symbol("class") -> "multi-checkbox-list"
      )
      @if(errors.nonEmpty) {
        </div>
      }
      @errors.map { error =>
        <div class="text-danger">@error.format</div>
      }
    }
  </div>
</div>
