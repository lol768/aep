@import controllers.admin.AssessmentsController.AssessmentFormData
@import domain.Assessment
@import domain.Assessment.{AssessmentType, Platform}
@import views.html.b3.vertical.VerticalFieldConstructor
@(existing: Option[Assessment])(implicit context: RequestContext, request: RequestHeader, messages: MessagesProvider, vfc: VerticalFieldConstructor, form: Form[AssessmentFormData])

<div class="row">
  <div class="col-sm-6">
    @if(existing.exists(e => e.assessmentType.nonEmpty && e.tabulaAssessmentId.nonEmpty)) {
      @b3.hidden(form("assessmentType"))
    }
    @b3.radio(form("assessmentType"), Symbol("_label") -> "Type") { implicit extraInfo =>
      @AssessmentType.values.map { t => @b3.radioOption(
        t.entryName,
        t.label,
        Symbol("data-valid-durations") -> t.validDurations.mkString("[", ",", "]"),
        /* Intentionally disabled, not readonly here - radio buttons don't support readonly */
        Symbol("disabled") -> existing.exists(e => e.assessmentType.nonEmpty && e.tabulaAssessmentId.nonEmpty)
      )}
    }
  </div>
  <div class="col-sm-6">
    @defining(form.errors("platform")) { errors =>
      @if(errors.nonEmpty) {
        <div class="has-error">
      }
      @b3.multiCheckbox(
        Platform.values.map { p =>
          form("platform[]") -> Seq(
            Symbol("id") -> s"platform_${p.entryName}",
            Symbol("_text") -> p.label,
            Symbol("value") -> p.entryName,
            Symbol("checked") -> form.data.filter(_._1.contains("platform")).values.toSeq.contains(p.entryName)
          )
        }: _*
      )(
        Symbol("_id") -> "platform_field",
        Symbol("_label") -> "Platform",
        Symbol("class") -> "multi-checkbox-list"
      )
      @if(errors.nonEmpty) {
        </div>
      }
      @errors.map { error =>
        <div class="text-danger">@error.format</div>
      }
    }
  </div>
</div>
